# 同网共享：用本机 Mac 作为只读服务器

将 SLG Monitor 前端共享给同一局域网内的同事访问，**本机文件仅被读取，不会被修改或删除**。

---

## 一、安全说明（本地文件保护）

- 当前服务器是 **纯静态、只读** 服务：
  - 只支持 **GET / HEAD** 请求（浏览器访问、加载页面和资源）。
  - **PUT / POST / DELETE / PATCH** 等写操作一律返回 `405 Method Not Allowed`，不会执行任何写盘操作。
- 因此：
  - 同事只能 **查看** 前端页面和数据（JSON、表格等）。
  - **不会** 通过本服务删除、修改、上传任何本地文件。
- 若需进一步隔离，可把项目放在只读目录或只读磁盘映像中（系统级设置，非本脚本职责）。

---

## 二、操作步骤

### 1. 在本机（你的 Mac）启动服务

在项目根目录执行：

```bash
cd "/Users/codfz1/Desktop/Tuyoo Internship/SLG Monitor 3.0"
python server/start_server.py
```

默认监听 **8000** 端口。若被占用可指定其他端口，例如：

```bash
python server/start_server.py --port 8001
```

启动后终端会打印类似：

```
============================================================
SLG Monitor 静态资源服务（只读，不修改/不删除任何文件）
============================================================
本机访问:   http://localhost:8000/frontend/
同网访问:   http://192.168.1.100:8000/frontend/
按 Ctrl+C 或 PyCharm 停止按钮结束服务
============================================================
```

其中 **同网访问** 那一行的 `192.168.1.100` 即为本机在当前局域网下的 IP（你的机器可能不同，以终端输出为准）。

### 2. 确认本机 IP（若终端未显示同网地址）

- **系统设置 → 网络 → Wi‑Fi / 以太网 → 详细信息** 中可看到本机 IP（如 `192.168.x.x`）。
- 或在终端执行：`ifconfig | grep "inet "`，排除 `127.0.0.1` 后的即为本机局域网 IP。

### 3. 同事如何访问

- 确保同事设备与你的 Mac 在 **同一局域网**（同一 Wi‑Fi 或同一有线网段）。
- 在同事的浏览器地址栏输入（将 IP 换成你本机实际 IP）：
  - **http://\<本机IP\>:8000/frontend/**
  - 例如：`http://192.168.1.100:8000/frontend/`

即可打开 SLG Monitor 前端，查看公司维度、产品维度、素材维度等页面。

### 4. 仅本机使用、禁止同网访问（可选）

若只想在自己电脑上访问，不允许局域网内其他人连进来，可加 `--local-only`：

```bash
python server/start_server.py --local-only
```

此时只监听 `127.0.0.1`，同网同事无法通过 IP 访问。

---

## 三、素材视频（同网可正常播放）

- 素材维度页的视频来自外部 CDN（如 `x-ad-assets.s3.amazonaws.com`）。另一台电脑若无法直连该 CDN（网络/防火墙/Referer 限制），会加载失败。
- 本服务已内置 **视频代理**：前端会把外部视频地址改为通过本机转发（`/video-proxy?url=...`），即另一台电脑只向你的 Mac 请求视频，由 Mac 向 CDN 拉取并返回。只要同事能访问你的 Mac 地址，素材视频即可正常播放。
- 代理仅允许转发到已知 CDN 主机（含 `x-ad-assets` + `amazonaws`），不会代理任意网址。

---

## 四、常见问题

| 情况 | 处理 |
|------|------|
| 同事打不开页面 | 1）确认本机防火墙是否放行 8000 端口；2）确认同事与本机在同一网段；3）本机不要休眠/关网。 |
| 端口被占用 | 使用 `python server/start_server.py --port 8001`（或其它未占用端口），并让同事用新端口访问。 |
| 想彻底禁止写操作 | 当前实现已禁止 PUT/POST/DELETE/PATCH，不会写文件；无需额外配置。 |

---

## 五、停止服务

在本机运行服务的终端中按 **Ctrl+C**，或关闭该终端窗口，即可停止服务，同事将无法再访问。
