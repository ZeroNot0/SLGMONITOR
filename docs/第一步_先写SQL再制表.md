# 第一步：从已有数据完成（制表 + 刷新周索引）

在已启用 MySQL（USE_MYSQL=1）的前提下，可以不必每次上传 13 个 CSV，而用**一次操作**「从已有数据完成第一步」完成制表并刷新周索引。

---

## 一个完整第一步（不传 CSV）

在【数据维护】→ 公司维度大盘数据（第一步）卡片下方，填写**年份**与**周标签**，点击 **「从已有数据完成第一步」**。系统会：

1. **若有该周的产出文件**（`output/`、`intermediate/`）：执行流水线步骤 5（制表），把该周数据同步到 MySQL，并刷新周索引。
2. **若该周无产出文件但已启用 MySQL**：仍会刷新周索引；若你已把该周数据写入 MySQL（`formatted_data`、`metrics_total` 等），选周后即可直接查看。

即：**制表 + 刷新周索引** 在一次点击内完成，无需拆成两个按钮。

---

## 推荐流程（每周新数据）

1. **首次或需要重算时**：上传 13 个 CSV，执行「上传并执行第一步」→ 数据落盘并同步到 MySQL。
2. **之后每周**（二选一）：
   - **方式 A**：用脚本/ETL 把新周数据写入 MySQL 的 `formatted_data`、`metrics_total`，再在页面填年/周，点一次 **「从已有数据完成第一步」**（会刷新周索引，该周出现在选择器中）。
   - **方式 B**：在别处或本机已生成好该周的 `output/`、`intermediate/` 文件，填年/周后点 **「从已有数据完成第一步」**，由系统制表并同步到 MySQL、刷新周索引。

---

## 接口说明（供脚本/自动化调用）

- **从已有数据完成第一步**：`POST /api/maintenance/phase1_table_only`，Body JSON：`{ "year": 2026, "week_tag": "0119-0125" }`。会尝试执行步骤 5；若启用 MySQL 会同步该周数据到库并**始终刷新周索引**。
- **仅刷新周索引**（仅脚本用）：`POST /api/maintenance/refresh_weeks_index`，Body JSON：`{ "year": 2026, "week_tag": "0119-0125" }`。

接口均需登录后带 cookie 调用。
