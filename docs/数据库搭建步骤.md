# SLG Monitor 3.0 — 数据库搭建步骤

在宝塔里创建 MySQL 数据库并导入表结构，按下面顺序做即可。

---

## 一、在宝塔里创建数据库（若还没建）

1. 宝塔左侧点 **「数据库」**。
2. 点 **「添加数据库」**：
   - **数据库名**：`slg_monitor`（或自定，后面导入和代码里要用同一名字）
   - **用户名**：`slg_monitor`（或自定）
   - **密码**：设一个强密码，**记下来**
   - **访问权限**：本地服务器（或所有人，按需）
3. 点 **「提交」**，在列表里确认能看到该库。

---

## 二、导入表结构（建表）

### 方式 A：用 phpMyAdmin（推荐）

1. 在 **「数据库」** 列表里，找到刚建的 `slg_monitor`，点右侧 **「管理」**（或「phpMyAdmin」）。
2. 左侧选中 **`slg_monitor`**。
3. 顶部点 **「导入」**（或「Import」）。
4. **「选择文件」**：选你本机或服务器上的 **`backend/db/schema.sql`**。  
   - 若文件在本地：先上传到服务器（宝塔「文件」里放到如 `/www/wwwroot/slg-monitor/backend/db/schema.sql`），再在 phpMyAdmin 里选该路径或本地上传。
   - 若在服务器上：phpMyAdmin 有时只能选「本机」即服务器路径，填 `/www/wwwroot/slg-monitor/backend/db/schema.sql`（路径按你实际项目改）。
5. 编码选 **utf8mb4**（或默认），点 **「执行」**。
6. 看到「导入已成功」后，左侧表列表里应出现：`app_config`、`year_weeks`、`formatted_data`、`product_strategy`、`creative_products`、`metrics_total`、`metrics_rank`、`new_products`、`product_theme_style_mapping`、`basetable`、`users`、`sessions`。

### 方式 B：用终端命令行

1. 宝塔 **「终端」** 或 SSH 登录服务器。
2. 确认项目里有 `backend/db/schema.sql`，然后执行（**把数据库名、用户名、密码换成你创建的**）：

```bash
cd /www/wwwroot/slg-monitor
mysql -u slg_monitor -p slg_monitor < backend/db/schema.sql
```

提示输入密码时，填你在宝塔里设的数据库密码。执行无报错即建表完成。

3. 检查表是否创建成功：

```bash
mysql -u slg_monitor -p -e "USE slg_monitor; SHOW TABLES;"
```

应列出上述 12 张表。

---

## 三、表结构说明（简要）

| 表名 | 用途 |
|------|------|
| **app_config** | 存 weeks_index、data_range 等全局配置 JSON |
| **year_weeks** | 按年/周索引（可选） |
| **formatted_data** | 公司维度大盘（每 year+week_tag 一条，payload 为 {headers, rows}） |
| **product_strategy** | 产品维度爆量旧/新（strategy_type=old/new） |
| **creative_products** | 素材维度产品列表 |
| **metrics_total** | 产品总表（数据底表-产品总表） |
| **metrics_rank** | 产品赛道排名（可选） |
| **new_products** | 上线新游（全局一条 id=1） |
| **product_theme_style_mapping** | 题材/画风映射（全局一条 id=1） |
| **basetable** | 5 张底表：product_mapping、company_mapping、theme_label、gameplay_label、art_style_label |
| **users** | 用户（替代 auth_users.json） |
| **sessions** | 登录会话（替代内存 session） |

详细字段和重构前后对照见 **docs/数据表与查询梳理及重构表结构.md**。

---

## 四、下一步：导入现有数据（可选）

表建好后，目前前端仍从 **文件**（`frontend/data/*.json`、mapping/*.xlsx）读数据；要**让前端从数据库读**，需要：

1. **一次性把现有 JSON/Excel 导入 MySQL**：  
   运行项目里的**数据迁移脚本**（若已提供，一般在 `backend/db/` 下，如 `migrate_data.py`），把 `frontend/data/` 和 `mapping/`、`labels/` 等数据写入对应表。
2. **改后端**：  
   增加一套 API（如 Flask），从 MySQL 查数据并返回与当前前端一致的 JSON 结构。
3. **改前端**：  
   把原来请求静态 JSON 的地址改为请求上述 API。

若你**暂时不打算切到数据库读**，只先「把库和表建好」，做到**第二步**即可；等后端 API 和迁移脚本就绪后，再按文档做数据迁移和接口切换。

---

## 五、小结

| 步骤 | 操作 |
|------|------|
| 1 | 宝塔「数据库」→ 添加数据库 `slg_monitor`，记下用户名和密码 |
| 2 | 在 phpMyAdmin 中选中该库 → 导入 `backend/db/schema.sql`；或用命令行 `mysql -u 用户 -p 库名 < backend/db/schema.sql` |
| 3 | 确认 12 张表都创建成功 |
| 4 | （后续）运行数据迁移脚本、接好后端 API、前端改为调 API |

按顺序完成 1～3，数据库就搭好了；第 4 步等迁移脚本与 API 准备好后再做即可。
